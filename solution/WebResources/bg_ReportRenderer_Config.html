<html><head>
<meta></head>
<body style="word-wrap: break-word;">
    ï»¿


    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Configuration - Report Generator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="/_common/styles/global.css.aspx" rel="stylesheet">
    <link href="/_common/styles/fonts.css.aspx" rel="stylesheet">
    <link href="/_common/styles/theme.css.aspx?theme=Outlook15White" rel="stylesheet">
    <link href="/_forms/controls/form.css.aspx" rel="stylesheet">
    <link href="/_forms/controls/controls.css.aspx" rel="stylesheet">
    <link href="/_nav/tabs.css.aspx" rel="stylesheet">&gt;
    <style type="text/css">
        .ms-crm-InlineTabHeader {
            padding-left: 0px !important;
        }
    </style>


    <!--[if lte IE 9]>
        <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
    <![endif]-->

    <table cellspacing="0" cellpadding="0" class="ms-crm-InlineTabHeader ms-crm-InlineTabBorder" id="{75E0F48A-3E68-11DD-81CE-00188B01DCE6}_Header">
        <tbody>
            <tr>
                <td class="ms-crm-InlineTabHeaderExpander">
                    <a href="#">
                        <img src="/_imgs/imagestrips/transparent_spacer.gif" class="ms-crm-InlineTabExpander ms-crm-ImageStrip-tab_down">
                    </a>
                </td>
                <td class="ms-crm-InlineTabHeaderText">
                    <a href="#" class="ms-crm-InlineTabHeaderText">
                        <h2 class="ms-crm-Form">Configuration</h2>
                    </a>
                </td>
            </tr>
        </tbody>
    </table>


    <div class="ms-crm-FormBodyContainer ms-crm-NoRIPane">
        <div class="ms-crm-Form-Area">
            <form class="ms-crm-Form">
                <div class="ms-crm-InlineTabContainer">
                    <div class="ms-crm-InlineTab">
                        <table cellspacing="0" cellpadding="0" class="ms-crm-InlineTabHeader ms-crm-InlineTabBorder">
                            <tbody>
                                <tr>
                                    <td class="ms-crm-InlineTabHeaderExpander">
                                        <a href="#" tabindex="1000">
                                            <img src="/_imgs/imagestrips/transparent_spacer.gif" class="ms-crm-InlineTabExpander ms-crm-ImageStrip-tab_down">
                                        </a>
                                    </td>
                                    <td class="ms-crm-InlineTabHeaderText">
                                        <a href="#" class="ms-crm-InlineTabHeaderText">
                                            <h2 class="ms-crm-Form">Settings</h2>
                                        </a>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <table cellspacing="0" cellpadding="0" class="ms-crm-InlineTabBody">
                            <colgroup>
                                <col>
                            </colgroup>
                            <tbody>
                                <tr>
                                    <td valign="top">
                                        <div class="ms-crm-FormSection-Container">
                                            <table class="ms-crm-FormSection" columns="2" style="table-layout:fixed;" height="1%" width="50%" valign="top" cellspacing="0" cellpadding="3">
                                                <colgroup>
                                                    <col width="115">
                                                    <col>
                                                </colgroup>
                                                <tbody id="settings">
                                                    <tr height="5">
                                                        <td></td>
                                                        <td></td>
                                                    </tr>
                                                    <tr>
                                                        <td class="ms-crm-FieldLabel-LeftAlign FormSection_CellPadding">
                                                            <label>Username</label>
                                                        </td>
                                                        <td>
                                                            <div class="ms-crm-Input-Container">
                                                                <input id="username" type="text" class="ms-crm-Input ms-crm-Text" autocomplete="off" style="background-image: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAASCAYAAABSO15qAAAAAXNSR0IArs4c6QAAAPhJREFUOBHlU70KgzAQPlMhEvoQTg6OPoOjT+JWOnRqkUKHgqWP4OQbOPokTk6OTkVULNSLVc62oJmbIdzd95NcuGjX2/3YVI/Ts+t0WLE2ut5xsQ0O+90F6UxFjAI8qNcEGONia08e6MNONYwCS7EQAizLmtGUDEzTBNd1fxsYhjEBnHPQNG3KKTYV34F8ec/zwHEciOMYyrIE3/ehKAqIoggo9inGXKmFXwbyBkmSQJqmUNe15IRhCG3byphitm1/eUzDM4qR0TTNjEixGdAnSi3keS5vSk2UDKqqgizLqB4YzvassiKhGtZ/jDMtLOnHz7TE+yf8BaDZXA509yeBAAAAAElFTkSuQmCC&quot;); background-repeat: no-repeat; background-attachment: scroll; background-size: contain; background-position: 98% 50%;">
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td class="ms-crm-FieldLabel-LeftAlign FormSection_CellPadding">
                                                            <label>Password</label>
                                                        </td>
                                                        <td>
                                                            <div class="ms-crm-Input-Container">
                                                                <input id="password" type="password" class="ms-crm-Input ms-crm-Text" autocomplete="off" style="background-image: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAASCAYAAABSO15qAAAAAXNSR0IArs4c6QAAAPhJREFUOBHlU70KgzAQPlMhEvoQTg6OPoOjT+JWOnRqkUKHgqWP4OQbOPokTk6OTkVULNSLVc62oJmbIdzd95NcuGjX2/3YVI/Ts+t0WLE2ut5xsQ0O+90F6UxFjAI8qNcEGONia08e6MNONYwCS7EQAizLmtGUDEzTBNd1fxsYhjEBnHPQNG3KKTYV34F8ec/zwHEciOMYyrIE3/ehKAqIoggo9inGXKmFXwbyBkmSQJqmUNe15IRhCG3byphitm1/eUzDM4qR0TTNjEixGdAnSi3keS5vSk2UDKqqgizLqB4YzvassiKhGtZ/jDMtLOnHz7TE+yf8BaDZXA509yeBAAAAAElFTkSuQmCC&quot;); background-repeat: no-repeat; background-attachment: scroll; background-size: contain; background-position: 98% 50%;">
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <tr><td></td><td></td></tr>
                                                </tbody>
                                                <tfoot>
                                                    <tr>
                                                        <td>
                                                            <input type="button" class="ms-crm-Button" onclick="UpdateConfig()" value="Submit">
                                                        </td>
                                                        <td></td>
                                                    </tr>
                                                </tfoot>
                                            </table>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <script type="text/javascript">
        function UpdateConfig() {
            GetMessageIds().then(messageIds => {
                for (var message of messageIds) {
                    var messageId = message.sdkmessageid;
                    retrieve("/sdkmessageprocessingsteps?$select=_sdkmessageprocessingstepsecureconfigid_value&$filter=stage eq 40 and _sdkmessageid_value eq " + messageId).then(response => {
                        var username = document.getElementById('username').value;
                        var password = document.getElementById('password').value;

                        var config = {
                            resource: window.location.origin,
                            username: username,
                            password: password
                        }
                        var data = {
                            secureconfig: JSON.stringify(config)
                        }

                        for (var value of response.value) {
                            var configId = value._sdkmessageprocessingstepsecureconfigid_value;
                            if (configId != null) {

                                update("/sdkmessageprocessingstepsecureconfigs(" + configId + ")", data).then(response => {
                                    alert("updated successfully");
                                });
                            } else {
                                create("/sdkmessageprocessingstepsecureconfigs", data).then(id => {
                                    update("/sdkmessageprocessingsteps(" + value.sdkmessageprocessingstepid + ")", {
                                        "sdkmessageprocessingstepsecureconfigid@odata.bind": id
                                    });
                                });
                            }
                        }
                    });
                }
            });

        }
        function GetMessageIds() {
            return retrieve("/sdkmessages?$select=sdkmessageid&$filter=startswith(name, 'bg_Render')").then(response => {
                return Promise.resolve(response.value);
            });
        }
        function retrieve(url) {
            return submit("GET", url).then(response => {
                return response.json();
            });
        }
        function create(url, body) {
            return submit("POST", url, body).then(response => {
                return Promise.resolve(response.headers.get('OData-EntityId'));
            });;
        }
        function update(url, body) {
            return submit('PATCH', url, body);
        }

        function submit(method, url, body) {
            headers = {
                'Accept': 'application/json; odata.metadata=none',
                'Content-Type': 'application/json',
                'Cache-Control': 'no-cache, no-store'
            };

            return fetch("/api/data/v9.0" + url, {
                credentials: 'same-origin',
                method: method,
                headers: headers,
                body: typeof body === 'string' ? body : JSON.stringify(body)
            })
        }
    </script>


</body></html>